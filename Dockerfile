FROM node:12

RUN npm install -g @quasar/cli

RUN git clone -b dev --depth=1 https://opdomun:43sK-qpx5w7Uny2n2SW5@gitlab.com/opdomun-projects/web-app.git
WORKDIR web-app

RUN npm install && quasar build -m ssr

FROM lfdominguez/nginx-brotli

RUN echo "c2VydmVyIHsKICAgIGxpc3RlbiAgICAgICA4MDsKICAgIHNlcnZlcl9uYW1lICBfOwoKICAgIGd6aXAgb247CiAgICBnemlwX3N0YXRpYyBvbjsKICAgIGd6aXBfdmFyeSBvbjsKICAgIGd6aXBfbWluX2xlbmd0aCAxMDI0MDsKICAgIGd6aXBfY29tcF9sZXZlbCA5OwogICAgZ3ppcF9wcm94aWVkIGV4cGlyZWQgbm8tY2FjaGUgbm8tc3RvcmUgcHJpdmF0ZSBhdXRoOwogICAgZ3ppcF90eXBlcyB0ZXh0L3BsYWluIHRleHQvY3NzIHRleHQveG1sIHRleHQvamF2YXNjcmlwdCBhcHBsaWNhdGlvbi94LWphdmFzY3JpcHQgYXBwbGljYXRpb24veG1sOwogICAgZ3ppcF9kaXNhYmxlICJNU0lFIFsxLTZdXC4iOwoKICAgIGJyb3RsaSBvbjsKICAgIGJyb3RsaV9zdGF0aWMgb247CiAgICBicm90bGlfY29tcF9sZXZlbCA5OwogICAgYnJvdGxpX3R5cGVzIGFwcGxpY2F0aW9uL2F0b20reG1sIGFwcGxpY2F0aW9uL2phdmFzY3JpcHQgYXBwbGljYXRpb24vanNvbiBhcHBsaWNhdGlvbi9yc3MreG1sCiAgICAgICAgICAgICBhcHBsaWNhdGlvbi92bmQubXMtZm9udG9iamVjdCBhcHBsaWNhdGlvbi94LWZvbnQtb3BlbnR5cGUgYXBwbGljYXRpb24veC1mb250LXRydWV0eXBlCiAgICAgICAgICAgICBhcHBsaWNhdGlvbi94LWZvbnQtdHRmIGFwcGxpY2F0aW9uL3gtamF2YXNjcmlwdCBhcHBsaWNhdGlvbi94aHRtbCt4bWwgYXBwbGljYXRpb24veG1sCiAgICAgICAgICAgICBmb250L2VvdCBmb250L29wZW50eXBlIGZvbnQvb3RmIGZvbnQvdHJ1ZXR5cGUgaW1hZ2Uvc3ZnK3htbCBpbWFnZS92bmQubWljcm9zb2Z0Lmljb24KICAgICAgICAgICAgIGltYWdlL3gtaWNvbiBpbWFnZS94LXdpbi1iaXRtYXAgdGV4dC9jc3MgdGV4dC9qYXZhc2NyaXB0IHRleHQvcGxhaW4gdGV4dC94bWw7CgogICAgbG9jYXRpb24gLyB7CiAgICAgICAgcm9vdCAgIC91c3Ivc2hhcmUvbmdpbngvaHRtbDsKICAgICAgICBpbmRleCAgaW5kZXguaHRtbDsKICAgIH0KfQ==" | base64 -d > /etc/nginx/conf.d/default.conf

COPY --from=0 /web-app/dist/spa/ /usr/share/nginx/html/
